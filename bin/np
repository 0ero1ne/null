#!/usr//bin/env python3
# nmap parser
# 0.3-b1
# nmap parser with features


# Libraries
try:
	import subprocess, sys, socket, requests, time, os
except ImportError:
	print("Cannot import libraries!")


# Scan function
def Scanner():
	host_list = []
	try:
		while True:
			# Variables
			ip = "192.168.1.1"
			subnet="24"
			host_current = []
			
			# Outputs
			os.system("clear")
			print("\x1b[1;35m\t\t\t  0eroScanner\n")		
			# Nmap process
			p = str(str(subprocess.Popen(
	                                		[r"sudo","nmap","-sn",ip+"/"+subnet],
	                                		stdout=subprocess.PIPE).communicate()
	                                		).split('\\n')).split('Nmap')[2:-2]
			#############
			# Parse data
			for c,x in enumerate(p):
				############## DEBUG
				#print(x)
				############## EOD
				ip = str(str(x.split(",")[0]).split(" ")[-1]).translate({ord(i): None for i in '()'})[:-1]
				if "MAC" in x.split(",")[2]:
					mac = str(x.split(",")[2]).split(" ")[3]
					nvendor = x.split("(")[-1][:-5]
				else:
					nvendor = "Unknown"
					mac = "Unknown"
				if len(str(x.split(",")[0]).split(" ")) < 6: 
					name = "Unknown"
				else:
					name = str(x.split(",")[0]).split(" ")[4]		
				print("\x1b[1;33m{0:>15} \x1b[1;31m|\x1b[1;32m {1} \x1b[1;31m|\x1b[1;35m {2} \x1b[1;34m({3})".format(ip,mac,name,nvendor))
				host_current.append(mac)
				# Sleep time for macvendors request
				time.sleep(0.5)
			# End of parser
			###############
			# Check lists and clean them
			for x in host_current:
				if x not in host_list:
					host_list.append(x)
					os.system("say +")
			for y in host_list:
				if y not in host_current:
					os.system("say -")
					host_list.remove(y)
			# End of check
			###############
			# Sleep time between each scan
			time.sleep(3)
	# If CTRL-C print exit message
	except KeyboardInterrupt:
		print('\x1b[;1mExit...')

# Run
Scanner()